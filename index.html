<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://dimplejs.org/dist/dimple.v2.0.0.min.js"></script>
  
    <style>
      circle.dimple-series-1 {
        fill: red;
      }
      h2 {
        text-align: center;
      }
    </style>
    <script type="text/javascript">
      function draw(data) {
        
          ad_array =[];
          ad_array = getAverageDelay("weather_delay");
          ad_array = ad_array.concat(getAverageDelay("security_delay"));
          ad_array = ad_array.concat(getAverageDelay("nas_delay"));
          ad_array = ad_array.concat(getAverageDelay("late_aircraft_delay"));
          ad_array = ad_array.concat(getAverageDelay("carrier_delay"));

      /*
        D3.js setup code
      */

          "use strict";
          var margin = 75,
              width = 1400 - margin,
              height = 600 - margin;
              
          debugger;
          
          d3.select('body')
            .append('h2')
            .text("Monthly average flight delay");

          var svg = d3.select("body")
            .append("svg")
              .attr("width", width + margin)
              .attr("height", height + margin)
            .append('g')
                .attr('class','chart');

      /*
        Dimple.js Chart construction code
      */

          /*var myChart = new dimple.chart(svg, data);*/
          /*var myChart = new dimple.chart(svg, arrv_delay_year);*/
          var myChart = new dimple.chart(svg, ad_array);
          
          debugger;
          
          /*var x = myChart.addTimeAxis("x", "year");*/
          var x = myChart.addCategoryAxis("x", "month");
          /*myChart.addMeasureAxis("y", "arr_delay");*/
          /*myChart.addMeasureAxis("y", "weather_delay");*/
          myChart.addMeasureAxis("y", "arrival_delay");
          /*x.dataParseFormat = "%Y";
          x.tickFormat = "%Y";
          x.timeInterval = 1;*/
          
          debugger;
          
          myChart.addSeries("delay_type", dimple.plot.bar);
          myChart.addLegend(60, 10, 510, 20, "right");
          /*myChart.addSeries(null, dimple.plot.line);
          myChart.addSeries(null, dimple.plot.scatter);*/
          myChart.draw();
          
  
         /* Get Year-Average Delay */
        function getAverageDelay(typeofdealy) {
          arrv_delay_array =[];

          for(var j=1; j<=12; j++) {
            var arrv_array =[];
            var arrv_delay = -1;
            var sum_ad = 0;
            var cnt = 0;
            for(var i=0; i<data.length;i++) {
              if(data[i].month==j) {
                if(typeofdealy == "weather_delay") {
                  sum_ad = sum_ad + Number(data[i].weather_delay);
                  cnt += 1;
                } else if(typeofdealy == "security_delay") {
                  sum_ad = sum_ad + Number(data[i].security_delay);
                  cnt += 1;
                } else if(typeofdealy == "nas_delay") {
                  sum_ad = sum_ad + Number(data[i].nas_delay);
                  cnt += 1;
                } else if(typeofdealy == "late_aircraft_delay") {
                  sum_ad = sum_ad + Number(data[i].late_aircraft_delay);
                  cnt += 1;
                } else if(typeofdealy == "carrier_delay") {
                  sum_ad = sum_ad + Number(data[i].carrier_delay);
                  cnt += 1;
                } else {
                  break;
                }
              }
            }
            arrv_delay = sum_ad / cnt;
            arrv_array["month"] = String(j);
            arrv_array["delay_type"] = String(typeofdealy);
            arrv_array["arrival_delay"] = String(arrv_delay);
            arrv_delay_array.push(arrv_array);
            /*debugger;*/
          }
          return arrv_delay_array;
        }
          
        };
      </script>
  </head>
<body>
  <script type="text/javascript">
  /*
    Use D3 (not dimple.js) to load the CSV file
    and pass the contents of it to the draw function
    */
  /*  d3.csv("data/flight-test-0001.csv",
        draw);*/
  /*  d3.csv("data/501305392_122016_2248_airline_delay_causes.csv",
        draw);*/
    d3.csv("data/501305392_122016_2248_airline_delay_causes_2.csv",
        draw);
  </script>
</body>
</html>
